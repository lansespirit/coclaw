---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Section from '../../components/layout/Section.astro';
import { IconAws, IconBolt, IconCollection, IconServer } from '../../components/icons';

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const breadcrumbData = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Home', item: 'https://coclaw.com/' },
    {
      '@type': 'ListItem',
      position: 2,
      name: 'Getting Started',
      item: 'https://coclaw.com/getting-started/',
    },
    { '@type': 'ListItem', position: 3, name: 'AWS', item: canonicalURL.toString() },
  ],
};

const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'HowTo',
  name: 'How to Deploy OpenClaw on AWS',
  description: 'Step-by-step guide to deploying OpenClaw on AWS EC2 or ECS/Fargate.',
  step: [
    {
      '@type': 'HowToStep',
      name: 'Choose AWS Service',
      text: 'Select between EC2 (VM) or ECS/Fargate (container)',
    },
    { '@type': 'HowToStep', name: 'Setup AWS Account', text: 'Create and configure AWS account' },
    { '@type': 'HowToStep', name: 'Launch Instance', text: 'Create and configure AWS resources' },
    { '@type': 'HowToStep', name: 'Deploy OpenClaw', text: 'Install and configure OpenClaw' },
    {
      '@type': 'HowToStep',
      name: 'Configure Auto-Scaling',
      text: 'Setup auto-scaling and monitoring',
    },
  ],
};
---

<BaseLayout
  title="Deploy OpenClaw on AWS - EC2 & ECS/Fargate Setup Guide"
  description="Complete guide to deploying OpenClaw on AWS. Step-by-step instructions for EC2 and ECS/Fargate."
  keywords="OpenClaw AWS, deploy OpenClaw AWS, OpenClaw EC2, OpenClaw ECS, OpenClaw Fargate, AWS AI assistant, OpenClaw cloud deployment"
>
  <script type="application/ld+json" slot="head" set:html={JSON.stringify(structuredData)} />
  <script type="application/ld+json" slot="head" set:html={JSON.stringify(breadcrumbData)} />

  <div
    class="bg-background min-h-screen overflow-x-hidden relative selection:bg-pink-500/30 selection:text-pink-950 dark:selection:text-pink-200"
  >
    <div class="flex flex-col gap-16 pb-16">
      <Section py="pt-24 pb-12" containerClass="text-center">
        <div class="flex justify-center mb-6">
          <div
            class="w-20 h-20 rounded-2xl bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center"
          >
            <IconAws className="w-12 h-12 text-white" aria-hidden="true" />
          </div>
        </div>
        <h1
          class="text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-br from-foreground to-foreground/70 bg-clip-text text-transparent"
        >
          Deploy OpenClaw on AWS
        </h1>
        <p class="text-xl text-default-800 dark:text-default-600 max-w-3xl mx-auto">
          Enterprise-grade deployment on EC2 or ECS/Fargate
        </p>
      </Section>

      <Section py="py-8">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl md:text-4xl font-bold mb-6">Choose Your AWS Deployment Method</h2>
          <div class="grid md:grid-cols-3 gap-6">
            <div
              class="p-6 rounded-xl bg-content1 border-2 border-divider hover:border-primary/50 transition-all"
            >
              <div
                class="w-12 h-12 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center mb-4"
              >
                <IconServer className="w-6 h-6 text-white" aria-hidden="true" />
              </div>
              <h3 class="text-xl font-bold mb-2">EC2 (Recommended)</h3>
              <p class="text-default-700 dark:text-default-500 text-sm">
                Full control • Easy setup • Best for most use cases
              </p>
            </div>

            <div
              class="p-6 rounded-xl bg-content1 border-2 border-divider hover:border-primary/50 transition-all"
            >
              <div
                class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center mb-4"
              >
                <IconBolt className="w-6 h-6 text-white" aria-hidden="true" />
              </div>
              <h3 class="text-xl font-bold mb-2">Lambda</h3>
              <p class="text-default-700 dark:text-default-500 text-sm">
                Serverless • Pay per use • Event-driven workloads
              </p>
            </div>

            <div
              class="p-6 rounded-xl bg-content1 border-2 border-divider hover:border-primary/50 transition-all"
            >
              <div
                class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center mb-4"
              >
                <IconCollection className="w-6 h-6 text-white" aria-hidden="true" />
              </div>
              <h3 class="text-xl font-bold mb-2">ECS/Fargate</h3>
              <p class="text-default-700 dark:text-default-500 text-sm">
                Containerized • Auto-scaling • Production-ready
              </p>
            </div>
          </div>
        </div>
      </Section>

      <Section py="py-8">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl md:text-4xl font-bold mb-8">Deploy on AWS EC2</h2>

          <div class="space-y-8">
            <div class="p-6 rounded-xl bg-content1 border-2 border-divider">
              <div class="flex items-center gap-4 mb-4">
                <div
                  class="w-12 h-12 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold text-xl"
                >
                  1
                </div>
                <h3 class="text-2xl font-bold">Launch EC2 Instance</h3>
              </div>
              <div class="space-y-4">
                <div>
                  <p class="text-default-700 dark:text-default-500 mb-2">
                    Create a new EC2 instance:
                  </p>
                  <ul class="space-y-2 text-default-700 dark:text-default-500 ml-4">
                    <li>• AMI: Ubuntu Server 22.04 LTS</li>
                    <li>• Instance Type: t3.micro (free tier) or t3.small</li>
                    <li>• Storage: 20GB gp3</li>
                    <li>
                      • Security Group: Allow SSH (22). (Recommended: keep the Gateway private and
                      access it via SSH tunnel or Tailscale.)
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="p-6 rounded-xl bg-content1 border-2 border-divider">
              <div class="flex items-center gap-4 mb-4">
                <div
                  class="w-12 h-12 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold text-xl"
                >
                  2
                </div>
                <h3 class="text-2xl font-bold">Connect to EC2 Instance</h3>
              </div>
              <div class="space-y-4">
                <div>
                  <p class="text-default-700 dark:text-default-500 mb-2">SSH into your instance:</p>
                  <div class="rounded-lg bg-content2 p-4">
                    <pre
                      class="text-sm overflow-x-auto"><code>{`chmod 400 your-key.pem
ssh -i your-key.pem ubuntu@YOUR_EC2_PUBLIC_IP`}</code></pre>
                  </div>
                </div>
              </div>
            </div>

            <div class="p-6 rounded-xl bg-content1 border-2 border-divider">
              <div class="flex items-center gap-4 mb-4">
                <div
                  class="w-12 h-12 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold text-xl"
                >
                  3
                </div>
                <h3 class="text-2xl font-bold">Install Dependencies</h3>
              </div>
              <div class="space-y-4">
                <div>
                  <p class="text-default-700 dark:text-default-500 mb-2">
                    Update system and install Node.js:
                  </p>
                  <div class="rounded-lg bg-content2 p-4">
                    <pre
                      class="text-sm overflow-x-auto"><code>{`sudo apt update && sudo apt upgrade -y
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt-get install -y nodejs
node --version`}</code></pre>
                  </div>
                </div>
              </div>
            </div>

            <div class="p-6 rounded-xl bg-content1 border-2 border-divider">
              <div class="flex items-center gap-4 mb-4">
                <div
                  class="w-12 h-12 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold text-xl"
                >
                  4
                </div>
                <h3 class="text-2xl font-bold">Install and Configure OpenClaw</h3>
              </div>
              <div class="space-y-4">
                <div>
                  <p class="text-default-700 dark:text-default-500 mb-2">
                    Install OpenClaw and run the setup wizard:
                  </p>
                  <div class="rounded-lg bg-content2 p-4">
                    <pre
                      class="text-sm overflow-x-auto"><code>{`npm install -g openclaw@latest
openclaw onboard --install-daemon
openclaw gateway status`}</code></pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </Section>

      <Section py="py-8" containerClass="bg-content1/50">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl md:text-4xl font-bold mb-8">AWS Lambda (Not Recommended)</h2>

          <div class="p-6 rounded-xl bg-content1 border border-divider">
            <p class="text-default-700 dark:text-default-500">
              OpenClaw’s Gateway is a long-running process with persistent state (credentials,
              sessions, config). AWS Lambda is request-based and not a good fit for running the
              Gateway. Prefer EC2 or ECS/Fargate (container).
            </p>
          </div>
        </div>
      </Section>

      <Section py="py-8">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl md:text-4xl font-bold mb-8">Deploy on AWS ECS/Fargate</h2>

          <div class="space-y-6">
            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Create Dockerfile</h3>
              <div class="rounded-lg bg-content2 p-4">
                <pre
                  class="text-sm overflow-x-auto"><code>{`FROM node:22-alpine

WORKDIR /app

RUN npm install -g openclaw@latest

# Persist this via EFS/EBS (mount to /data in ECS)
ENV OPENCLAW_STATE_DIR=/data/.openclaw

# Required for non-loopback binds: set OPENCLAW_GATEWAY_TOKEN via ECS env/secrets
EXPOSE 3000

# ECS/LB health checks typically expect a non-loopback bind + stable port
CMD ["openclaw", "gateway", "run", "--bind", "lan", "--port", "3000", "--auth", "token", "--allow-unconfigured"]`}</code></pre>
              </div>
            </div>

            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Build and Push to ECR</h3>
              <div class="rounded-lg bg-content2 p-4">
                <pre
                  class="text-sm overflow-x-auto"><code>{`# Build Docker image
docker build -t openclaw .

# Tag and push to ECR
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin YOUR_ACCOUNT.dkr.ecr.us-east-1.amazonaws.com
docker tag openclaw:latest YOUR_ACCOUNT.dkr.ecr.us-east-1.amazonaws.com/openclaw:latest
docker push YOUR_ACCOUNT.dkr.ecr.us-east-1.amazonaws.com/openclaw:latest`}</code></pre>
              </div>
            </div>

            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Create ECS Task Definition</h3>
              <p class="text-default-700 dark:text-default-500 mb-3">
                Use AWS Console or CLI to create an ECS task definition with:
              </p>
              <ul class="space-y-2 text-default-700 dark:text-default-500 ml-4">
                <li>• Launch Type: Fargate</li>
                <li>• CPU: 0.5 vCPU (start here; scale as needed)</li>
                <li>• Memory: 2 GB (recommended)</li>
                <li>• Container Image: Your ECR image URI</li>
              </ul>
            </div>
          </div>
        </div>
      </Section>

      <Section py="py-8" containerClass="bg-content1/50">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl md:text-4xl font-bold mb-8">AWS Security Best Practices</h2>

          <div class="space-y-6">
            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Use IAM Roles</h3>
              <p class="text-default-700 dark:text-default-500">
                Assign IAM roles to EC2 instances or ECS tasks instead of using access keys. This
                provides temporary credentials and better security.
              </p>
            </div>

            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Store Secrets in AWS Secrets Manager</h3>
              <p class="text-default-700 dark:text-default-500 mb-3">
                Store API keys and tokens securely:
              </p>
              <div class="rounded-lg bg-content2 p-4">
                <pre
                  class="text-sm overflow-x-auto"><code>{`aws secretsmanager create-secret \\
  --name openclaw/bot-token \\
  --secret-string "YOUR_BOT_TOKEN"`}</code></pre>
              </div>
            </div>

            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Enable CloudWatch Logging</h3>
              <p class="text-default-700 dark:text-default-500 mb-3">
                Monitor your application with CloudWatch:
              </p>
              <div class="rounded-lg bg-content2 p-4">
                <pre
                  class="text-sm overflow-x-auto"><code>{`# Install CloudWatch agent on EC2
sudo apt install amazon-cloudwatch-agent
# Configure log groups and metrics`}</code></pre>
              </div>
            </div>

            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Use VPC and Security Groups</h3>
              <p class="text-default-700 dark:text-default-500 mb-4">
                Deploy in a private subnet with NAT gateway for outbound traffic. Restrict inbound
                access using security groups.
              </p>
              <img
                src="/images/svg/groups-flow.svg"
                alt="AWS security groups flow diagram"
                loading="lazy"
                class="w-full rounded-lg border border-divider bg-content2 p-2"
              />
            </div>
          </div>
        </div>
      </Section>

      <Section py="py-8">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl md:text-4xl font-bold mb-8">Cost Optimization Tips</h2>

          <div class="grid md:grid-cols-2 gap-6">
            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Use Spot Instances</h3>
              <p class="text-default-700 dark:text-default-500">
                Save up to 90% by using EC2 Spot Instances for non-critical workloads. Configure
                auto-scaling to handle interruptions.
              </p>
            </div>

            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Right-Size Your Instances</h3>
              <p class="text-default-700 dark:text-default-500">
                Start with t3.micro and monitor usage. Use AWS Compute Optimizer recommendations to
                adjust instance types.
              </p>
            </div>

            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Use Reserved Instances</h3>
              <p class="text-default-700 dark:text-default-500">
                Commit to 1 or 3 years for up to 72% savings on predictable workloads. Consider
                Savings Plans for flexibility.
              </p>
            </div>

            <div class="p-6 rounded-xl bg-content1 border border-divider">
              <h3 class="text-xl font-bold mb-3">Enable Auto-Scaling</h3>
              <p class="text-default-700 dark:text-default-500">
                Scale down during low-traffic periods. Set up CloudWatch alarms to trigger scaling
                based on CPU or memory usage.
              </p>
            </div>
          </div>
        </div>
      </Section>

      <Section py="py-8" containerClass="text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-6">Next Steps</h2>
        <p class="text-default-800 dark:text-default-600 max-w-2xl mx-auto text-lg mb-8">
          Your OpenClaw instance is now running on AWS with enterprise-grade reliability
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <a
            href="/openclaw-config-generator"
            class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors font-semibold"
          >
            Configuration Generator
          </a>
          <a
            href="/resources"
            class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-content1 border border-divider hover:bg-content2 transition-colors font-semibold"
          >
            Browse Guides
          </a>
          <a
            href="/troubleshooting"
            class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-content1 border border-divider hover:bg-content2 transition-colors font-semibold"
          >
            Troubleshooting
          </a>
        </div>
      </Section>
    </div>
  </div>
</BaseLayout>
