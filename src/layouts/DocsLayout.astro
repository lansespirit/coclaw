---
import BaseLayout from './BaseLayout.astro';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    publishDate: Date | string | number;
    lastUpdated: Date | string | number;
    author?: string;
    category: string;
    difficulty?: string;
    estimatedTime?: string;
  };
}

const { frontmatter } = Astro.props;
// MDX `layout:` frontmatter values are not guaranteed to be `Date` objects.
// Coerce them so build-time rendering doesn't crash.
const publishDate =
  frontmatter.publishDate instanceof Date
    ? frontmatter.publishDate
    : new Date(frontmatter.publishDate);
const lastUpdated =
  frontmatter.lastUpdated instanceof Date
    ? frontmatter.lastUpdated
    : new Date(frontmatter.lastUpdated);
const hasValidPublishDate = !Number.isNaN(publishDate.getTime());
const hasValidLastUpdated = !Number.isNaN(lastUpdated.getTime());
---

<BaseLayout title={frontmatter.title} description={frontmatter.description}>
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <article class="prose prose-lg dark:prose-invert">
      <header class="mb-8">
        <div class="flex gap-2 mb-4">
          <span
            class="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-sm"
          >
            {frontmatter.category}
          </span>
          {
            frontmatter.difficulty && (
              <span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full text-sm">
                {frontmatter.difficulty}
              </span>
            )
          }
          {
            frontmatter.estimatedTime && (
              <span class="px-3 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full text-sm">
                {frontmatter.estimatedTime}
              </span>
            )
          }
        </div>
        <h1 class="text-4xl font-bold mb-4">{frontmatter.title}</h1>
        <p class="text-xl text-gray-600 dark:text-gray-400 mb-4">{frontmatter.description}</p>
        <div class="flex gap-4 text-sm text-gray-500 dark:text-gray-400">
          <span>By {frontmatter.author || 'CoClaw Team'}</span>
          <span>•</span>
          <time datetime={hasValidPublishDate ? publishDate.toISOString() : undefined}>
            {
              hasValidPublishDate
                ? publishDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                  })
                : 'Unknown date'
            }
          </time>
          {
            hasValidLastUpdated &&
              hasValidPublishDate &&
              lastUpdated.getTime() !== publishDate.getTime() && (
                <>
                  <span>•</span>
                  <span>
                    Updated{' '}
                    {lastUpdated.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </span>
                </>
              )
          }
        </div>
      </header>
      <slot />
    </article>
  </div>
</BaseLayout>
